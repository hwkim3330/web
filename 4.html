<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>S32G Ultimate Web Control Center</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css" />
<script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
<style>
:root {
--bg-deep-dark: #1e1e1e; --bg-dark: #252526; --bg-medium: #333; --border-color: #4a4a4a;
--text-light: #d4d4d4; --text-medium: #cccccc; --nxp-blue: #0e639c; --nxp-blue-hover: #1579b9;
--ai-purple: #8a63d2; --ai-purple-hover: #9b78e3; --keti-blue: #004b8d;
--color-green: #38a169; --color-yellow: #d19a66; --color-red: #e06c75;
}
html, body {
height: 100%; margin: 0; padding: 0; background-color: var(--bg-deep-dark); color: var(--text-light);
font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", Arial, sans-serif; overflow: hidden;
}
#page-container { display: flex; height: 100%; }
#terminal-pane { flex: 1.2; display: flex; flex-direction: column; min-width: 0; }
#gui-pane { flex: 1; background-color: var(--bg-dark); border-left: 1px solid var(--border-color); overflow-y: auto; padding-bottom: 20px; }
.pane-header {
padding: 10px 20px; background-color: var(--keti-blue); flex-shrink: 0;
border-bottom: 1px solid var(--border-color); font-size: 16px; font-weight: 600;
display: flex; align-items: center; justify-content: space-between; color: white;
}
.pane-header .logo { height: 28px; vertical-align: middle; margin-right: 12px; }
.pane-header .header-controls button { font-size: 12px; padding: 4px 8px; width: auto; background-color: var(--nxp-blue); }
#terminal-container { flex-grow: 1; padding: 0 10px 10px 10px; overflow: hidden; }
.gui-section { margin: 0 15px 10px; border: 1px solid var(--border-color); border-radius: 6px; background-color: var(--bg-deep-dark); overflow: hidden; }
.gui-section summary {
list-style: none; display: flex; align-items: center; gap: 8px; font-size: 16px; font-weight: 600;
padding: 12px 15px; background-color: #2a2d2e; cursor: pointer; color: #569cd6;
border-bottom: 1px solid var(--border-color);
}
.gui-section[open] > summary { border-bottom: 1px solid var(--border-color); }
.gui-section > div { padding: 15px; }
.button-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; }
button, select, input {
background-color: var(--nxp-blue); color: white; border: none; padding: 10px;
font-size: 14px; cursor: pointer; border-radius: 4px; transition: all 0.2s;
box-sizing: border-box; width: 100%; text-align: left; display: flex; align-items: center; gap: 8px;
}
button:hover:not(:disabled) { background-color: var(--nxp-blue-hover); transform: translateY(-1px); }
button:disabled, input:disabled, select:disabled { background-color: #555; color: #999; cursor: not-allowed; transform: none; }
button.busy { cursor: progress; opacity: 0.7; }
.input-group { display: flex; gap: 10px; margin-bottom: 12px; align-items: center;}
.input-group:last-child { margin-bottom: 0; }
.input-group label { white-space: nowrap; font-size: 14px; }
.input-group input, .input-group select { flex-grow: 1; background-color: #3c3c3c; border: 1px solid #555; padding: 10px; }
.input-group button { flex-shrink: 0; width: auto; justify-content: center; }
#controls { display: flex; align-items: center; padding: 10px 20px; background-color: var(--bg-medium); flex-wrap: wrap; gap: 10px; }
.status-text { margin-top: 10px; font-size: 14px; color: var(--color-yellow); }
</style>
</head>
<body>
  <div id="page-container">
    <div id="terminal-pane">
        <div id="controls">
            <button id="connectBtn" style="width:auto; background-color: var(--color-green);">ğŸ”Œ ì—°ê²°</button>
            <button id="disconnectBtn" style="width:auto;" disabled>âŒ ì—°ê²° í•´ì œ</button>
            <select id="baudRateSelect" style="width:auto;">
                <option value="115200" selected>115200</option><option value="57600">57600</option><option value="9600">9600</option>
            </select>
            <button id="clearTermBtn" style="width:auto;">ğŸ§¹ í„°ë¯¸ë„ ì§€ìš°ê¸°</button>
        </div>
        <div id="terminal-container"></div>
    </div>
    <div id="gui-pane">
        <div class="pane-header">
            <div>
                <img src="https://github.com/user-attachments/assets/eaa36443-81b3-41ab-995a-faea06c5f5af" class="logo" alt="KETI & NXP Logo">
                <span>S32G Ultimate Control Center</span>
            </div>
            <div class="header-controls">
                <button id="toggleAllSectionsBtn">ëª¨ë‘ ì ‘ê¸°</button>
            </div>
        </div>

        <details class="gui-section" open><summary>ğŸ“‚ íŒŒì¼ ì „ì†¡ ë° ê´€ë¦¬</summary><div>
            <div class="button-grid">
                <button class="cmd-btn" data-cmd="ls -lha">íŒŒì¼ ëª©ë¡ (ls -lha)</button>
                <button class="cmd-btn" data-cmd="pwd">í˜„ì¬ ê²½ë¡œ (pwd)</button>
            </div>
            <div class="input-group">
                <input type="text" id="cdPathInput" placeholder="/tmp/test">
                <button id="cdAndLsBtn">â¡ï¸ ê²½ë¡œ ì´ë™ & ëª©ë¡ í‘œì‹œ</button>
            </div>
            <hr style="border-color: var(--border-color); margin: 15px 0;">
            <div class="input-group">
                <label>ì—…ë¡œë“œ:</label>
                <input type="file" id="fileInput" style="flex-grow: 1;">
            </div>
            <div class="input-group">
                <input type="text" id="devicePathInput" placeholder="ì—…ë¡œë“œ ê²½ë¡œ (e.g., /tmp/file)">
                <button id="uploadFileBtn">â¬†ï¸ ì—…ë¡œë“œ</button>
            </div>
            <hr style="border-color: var(--border-color); margin: 15px 0;">
             <div class="input-group">
                <label>ë‹¤ìš´ë¡œë“œ:</label>
                <input id="downloadPathInput" placeholder="ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ ê²½ë¡œ" style="flex-grow: 1;">
                <button id="downloadFileBtn">â¬‡ï¸ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            <div id="transferStatus" class="status-text"></div>
        </div></details>
        
        <details class="gui-section"><summary>ğŸ“¡ ê³ ê¸‰ ë„¤íŠ¸ì›Œí‚¹ & TSN</summary><div>
            <div class="button-grid">
                 <button class="cmd-btn" data-cmd="ip -c a">IP ì£¼ì†Œ</button>
                 <button class="cmd-btn" data-cmd="ip route">ë¼ìš°íŒ… í…Œì´ë¸”</button>
                 <button class="cmd-btn" data-cmd="brctl show">ë¸Œë¦¿ì§€ ë³´ê¸°</button>
                 <button class="cmd-btn" data-cmd="iptables -L -n -v">iptables ëª©ë¡</button>
            </div>
            <hr style="border-color: var(--border-color); margin: 15px 0;">
            <div class="input-group"><label>Ethtool:</label><input id="ethtoolIfaceInput" type="text" value="eth0"><select id="ethtoolParamSelect"><option value="-T">Timestamping</option><option value="-S">Statistics</option><option value="-k">Features</option></select><button id="runEthtoolBtn">ì‹¤í–‰</button></div>
            <div class="input-group"><label>PTP4L:</label><input id="ptp4lIfaceInput" type="text" value="eth0"><button id="runPtp4lBtn">PTP ì‹¤í–‰</button></div>
            <div class="input-group"><label>TC Qdisc:</label><input id="tcIfaceInput" type="text" value="eth0"><select id="tcActionSelect"><option>add</option><option>replace</option><option>del</option></select><select id="tcQdiscSelect"><option>mqprio</option><option>cbs</option><option>taprio</option></select><button id="runTcBtn">TC ì‹¤í–‰</button></div>
        </div></details>
        
        <details class="gui-section"><summary>ğŸ“ˆ ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ & ìº¡ì³</summary><div>
             <div class="input-group"><label>tcpdump:</label><input id="tcpdumpInput" value="-i eth0 -c 20" placeholder="ì˜µì…˜"><button id="runTcpdumpBtn">ìº¡ì³ ì‹œì‘</button></div>
             <div class="input-group"><label>iperf3 ì„œë²„:</label><button class="cmd-btn" data-cmd="iperf3 -s">ì„œë²„ ì‹œì‘</button></div>
             <div class="input-group"><label>iperf3 í´ë¼:</label><input id="iperfClientInput" value="127.0.0.1 -u -b 100M" placeholder="<í˜¸ìŠ¤íŠ¸> [ì˜µì…˜]"><button id="runIperfClientBtn">í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰</button></div>
             <div class="input-group"><label>Ping:</label><input id="pingInput" placeholder="e.g., 8.8.8.8"><button id="pingBtn">Ping</button></div>
        </div></details>

        <details class="gui-section"><summary>ğŸšŒ CAN ë²„ìŠ¤</summary><div>
             <div class="button-grid">
                <button class="cmd-btn" data-cmd="ip -s link show can0">CAN0 ìƒíƒœ</button>
                <button class="cmd-btn" data-cmd="ip -s link show can1">CAN1 ìƒíƒœ</button>
            </div>
            <div class="input-group"><label>Candump:</label><input id="candumpInput" value="any" placeholder="<ì¸í„°í˜ì´ìŠ¤>"><button id="runCandumpBtn">ìˆ˜ì‹ </button></div>
            <div class="input-group"><label>Cansend:</label><input id="cansendInput" value="can0 123#112233" placeholder="<ì¸í„°í˜ì´ìŠ¤> <id>#<data>"><button id="sendCanBtn">ì „ì†¡</button></div>
        </div></details>

        <details class="gui-section" open><summary>ğŸ©º í”„ë¡œì„¸ìŠ¤ & ì‹œìŠ¤í…œ ë¡œê·¸</summary><div>
             <div class="button-grid">
                <button class="cmd-btn" data-cmd="ps aux">í”„ë¡œì„¸ìŠ¤ ëª©ë¡ (ps)</button>
                <button class="cmd-btn" data-cmd="top -b -n 1">Top í”„ë¡œì„¸ìŠ¤</button>
                <button class="cmd-btn" data-cmd="dmesg | tail -n 50">ì»¤ë„ ë¡œê·¸ (dmesg)</button>
            </div>
            <div class="input-group">
                <input type="text" id="pidInput" placeholder="ì¢…ë£Œí•  PID ì…ë ¥">
                <button id="killBtn" style="background-color: var(--color-yellow);">í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ</button>
            </div>
        </div></details>

        <details class="gui-section"><summary>â„¹ï¸ ì‹œìŠ¤í…œ ì •ë³´</summary><div>
            <div class="button-grid">
                <button class="cmd-btn" data-cmd="uname -a">ì»¤ë„ & OS</button>
                <button class="cmd-btn" data-cmd="lscpu | grep 'Model name'">CPU ëª¨ë¸</button>
                <button class="cmd-btn" data-cmd="free -h">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</button>
                <button class="cmd-btn" data-cmd="df -h">ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰</button>
            </div>
        </div></details>

        <details class="gui-section" open><summary>ğŸš¨ ì‹œìŠ¤í…œ ì œì–´</summary><div>
            <div class="button-grid">
                <button id="rebootBtn" style="background-color: var(--color-yellow);">ì¬ë¶€íŒ…</button>
                <button id="poweroffBtn" style="background-color: var(--color-red);">ì „ì› ë„ê¸°</button>
            </div>
        </div></details>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const App = {
        state: {
            port: null,
            reader: null,
            writer: null,
            isReading: false,
            onDataDisposable: null,
            areSectionsExpanded: true,
            fileDownloadInProgress: false,
            fileDownloadBuffer: '',
        },

        ui: {},
        
        term: new Terminal({
            cursorBlink: true, fontFamily: 'Consolas, "Courier New", monospace', fontSize: 14,
            theme: { background: '#1e1e1e', foreground: '#d4d4d4', cursor: '#d4d4d4', selectionBackground: '#555' }
        }),
        fitAddon: new FitAddon.FitAddon(),

        // --- ì´ˆê¸°í™” ---
        init() {
            if (!navigator.serial) {
                this.showCompatibilityError();
                return;
            }
            this.cacheUI();
            this.setupTerminal();
            this.setGuiEnabled(false);
            this.bindEvents();
        },

        cacheUI() {
            const ids = [
                'connectBtn', 'disconnectBtn', 'baudRateSelect', 'clearTermBtn', 'terminal-container', 'gui-pane',
                'toggleAllSectionsBtn',
                'cdPathInput', 'cdAndLsBtn', 'fileInput', 'devicePathInput', 'uploadFileBtn', 'downloadPathInput', 'downloadFileBtn', 'transferStatus',
                'ethtoolIfaceInput', 'ethtoolParamSelect', 'runEthtoolBtn',
                'ptp4lIfaceInput', 'runPtp4lBtn',
                'tcIfaceInput', 'tcActionSelect', 'tcQdiscSelect', 'runTcBtn',
                'tcpdumpInput', 'runTcpdumpBtn',
                'iperfClientInput', 'runIperfClientBtn',
                'pingInput', 'pingBtn',
                'candumpInput', 'runCandumpBtn', 'cansendInput', 'sendCanBtn',
                'pidInput', 'killBtn',
                'rebootBtn', 'poweroffBtn'
            ];
            ids.forEach(id => this.ui[id] = document.getElementById(id));
            
            this.ui.allGuiSections = document.querySelectorAll('.gui-section');
            this.ui.cmdBtns = document.querySelectorAll('.cmd-btn');
            this.ui.guiControls = document.querySelectorAll('#gui-pane button, #gui-pane input, #gui-pane select');
        },
        
        setupTerminal() {
            this.term.loadAddon(this.fitAddon);
            this.term.open(this.ui['terminal-container']);
            this.fitAddon.fit();
            new ResizeObserver(() => this.fitAddon.fit()).observe(this.ui['terminal-container']);
        },

        showCompatibilityError() {
            this.ui['terminal-container'].innerHTML = `<div style="padding: 20px; color: #ffcc00; font-size: 16px;"><h2>âš ï¸ Web Serial APIê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</h2><p>ì‚¬ìš© ì¤‘ì¸ ë¸Œë¼ìš°ì €ê°€ Web Serial APIë¥¼ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì‹  ë²„ì „ì˜ Chrome, Edge, Opera ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.</p></div>`;
            document.getElementById('controls').style.display = 'none';
            this.ui['gui-pane'].style.display = 'none';
        },
        
        // --- UI ë° ìƒíƒœ ê´€ë¦¬ ---
        setGuiEnabled(enabled) {
            this.ui.guiControls.forEach(c => c.disabled = !enabled);
            this.ui.connectBtn.disabled = enabled;
            this.ui.disconnectBtn.disabled = !enabled;
            this.ui.baudRateSelect.disabled = enabled;
        },

        toggleAllSections() {
            this.state.areSectionsExpanded = !this.state.areSectionsExpanded;
            this.ui.allGuiSections.forEach(section => section.open = this.state.areSectionsExpanded);
            this.ui.toggleAllSectionsBtn.textContent = this.state.areSectionsExpanded ? 'ëª¨ë‘ ì ‘ê¸°' : 'ëª¨ë‘ í¼ì¹˜ê¸°';
        },
        
        // --- ì‹œë¦¬ì–¼ í†µì‹  ---
        async sendSerial(data) {
            if (!this.state.port?.writable) return;
            try {
                this.state.writer = this.state.port.writable.getWriter();
                await this.state.writer.write(new TextEncoder().encode(data));
            } catch (e) {
                this.term.writeln(`\r\n\x1b[31m[ERROR] ì“°ê¸° ì‹¤íŒ¨: ${e.message}\x1b[0m`);
            } finally {
                if (this.state.writer) this.state.writer.releaseLock();
            }
        },

        async sendCommand(cmd, showInTerm = true) {
            if (this.state.port && cmd) {
                this.term.focus();
                if(showInTerm) this.term.writeln(`\x1b[36m$ ${cmd}\x1b[0m`);
                await this.sendSerial(cmd + '\r');
            }
        },
        
        async connect() {
            if (this.state.port) return;
            try {
                this.state.port = await navigator.serial.requestPort();
                await this.state.port.open({ baudRate: parseInt(this.ui.baudRateSelect.value, 10) });
                
                this.setGuiEnabled(true);
                this.state.isReading = true;
                this.readLoop();
                
                this.term.writeln('\x1b[32m[SYSTEM] S32G ì¥ì¹˜ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.\x1b[0m');
                this.term.focus();
                this.state.onDataDisposable = this.term.onData(data => this.sendSerial(data));
            } catch (error) {
                this.term.writeln(`\r\n\x1b[31m[ERROR] ${error.message}\x1b[0m`);
            }
        },
        
        async disconnect() {
            const portToClose = this.state.port;
            if (!portToClose) return;
            this.state.isReading = false;
            if (this.state.onDataDisposable) this.state.onDataDisposable.dispose();
            if (this.state.reader) { try { await this.state.reader.cancel(); } catch(e) {} }
            if (portToClose.writable) { try { await portToClose.writable.close(); } catch(e) {} }
            try { await portToClose.close(); } catch(e) {}
            
            if (this.state.port === portToClose) {
                this.state.port = null;
                this.setGuiEnabled(false);
                this.term.writeln('\r\n\x1b[33m[SYSTEM] ì—°ê²°ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.\x1b[0m');
            }
        },
        
        async readLoop() {
            while (this.state.port?.readable && this.state.isReading) {
                const reader = this.state.port.readable.getReader();
                this.state.reader = reader;
                try {
                    while (true) {
                        const { value, done } = await reader.read();
                        if (done) break;
                        
                        const decodedChunk = new TextDecoder().decode(value, { stream: true });
                        if (this.state.fileDownloadInProgress) {
                            this.handleFileDownloadChunk(decodedChunk);
                        } else {
                            this.term.write(decodedChunk);
                        }
                    }
                } catch (error) { 
                    if (this.state.isReading) this.term.writeln(`\r\n\x1b[31m[ERROR] ì½ê¸° ì‹¤íŒ¨: ${error.message}\x1b[0m`);
                } finally {
                    reader.releaseLock();
                    this.state.reader = null;
                }
            }
        },

        // --- íŒŒì¼ ì „ì†¡ ---
        handleFileUpload() {
            const file = this.ui.fileInput.files[0];
            const remotePath = this.ui.devicePathInput.value.trim();

            if (!file || !remotePath) {
                this.ui.transferStatus.textContent = 'ì—…ë¡œë“œí•  íŒŒì¼ê³¼ ì¥ì¹˜ ë‚´ ê²½ë¡œë¥¼ ëª¨ë‘ ì§€ì •í•´ì£¼ì„¸ìš”.';
                return;
            }

            const reader = new FileReader();
            this.ui.uploadFileBtn.disabled = true;
            this.ui.transferStatus.textContent = `íŒŒì¼ ì½ëŠ” ì¤‘: ${file.name}...`;

            reader.onload = (e) => {
                this.ui.transferStatus.textContent = 'íŒŒì¼ì„ Base64ë¡œ ì¸ì½”ë”© ì¤‘...';
                const base64Content = e.target.result.split(',')[1];
                const cmd = `echo '${base64Content}' | base64 -d > ${remotePath}`;
                
                this.term.writeln(`\r\n\x1b[33m[SYSTEM] ${file.name} -> ${remotePath} ì—…ë¡œë“œ ì¤‘...\x1b[0m`);
                this.sendCommand(cmd, false).then(() => {
                    this.term.writeln(`\r\n\x1b[32m[SYSTEM] ì—…ë¡œë“œ ëª…ë ¹ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\x1b[0m`);
                    this.ui.transferStatus.textContent = 'ì—…ë¡œë“œ ì‹œì‘ë¨!';
                });
            };
            reader.onerror = () => { 
                this.ui.transferStatus.textContent = `íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ${reader.error}`;
                this.term.writeln(`\r\n\x1b[31m[ERROR] íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ${reader.error}\x1b[0m`);
            };
            reader.onloadend = () => {
                this.ui.uploadFileBtn.disabled = false;
            };
            
            reader.readAsDataURL(file);
        },

        handleFileDownload() {
            const path = this.ui.downloadPathInput.value.trim();
            if (!path) {
                this.ui.transferStatus.textContent = 'ë‹¤ìš´ë¡œë“œí•  íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                return;
            }
            this.state.fileDownloadInProgress = true;
            this.state.fileDownloadBuffer = '';
            this.ui.transferStatus.textContent = `${path} íŒŒì¼ ìš”ì²­ ì¤‘...`;
            this.term.writeln(`\r\n\x1b[33m[SYSTEM] ${path} íŒŒì¼ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...\x1b[0m`);
            this.sendCommand(`if [ -f "${path}" ]; then cat "${path}" | base64; fi; echo "DOWNLOAD_END"`, false);
        },
        
        handleFileDownloadChunk(chunk) {
            this.state.fileDownloadBuffer += chunk;
            const endMarker = 'DOWNLOAD_END';
            if (this.state.fileDownloadBuffer.includes(endMarker)) {
                const fileData = this.state.fileDownloadBuffer.substring(0, this.state.fileDownloadBuffer.indexOf(endMarker)).trim();
                this.state.fileDownloadInProgress = false;
                this.term.writeln('\r\n\x1b[32m[SYSTEM] Base64 ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ. ë””ì½”ë”© ì¤‘...\x1b[0m');
                this.ui.transferStatus.textContent = 'ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ. ë””ì½”ë”© ì¤‘...';
                this.saveDownloadedFile(fileData);
                this.state.fileDownloadBuffer = '';
            }
        },

        saveDownloadedFile(base64Data) {
            try {
                const byteCharacters = atob(base64Data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) { byteNumbers[i] = byteCharacters.charCodeAt(i); }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray]);
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                const filename = this.ui.downloadPathInput.value.split('/').pop() || 'downloaded_file';
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                this.term.writeln(`\x1b[32m[SYSTEM] íŒŒì¼ "${filename}" ë‹¤ìš´ë¡œë“œ ì™„ë£Œ.\x1b[0m`);
                this.ui.transferStatus.textContent = `íŒŒì¼ "${filename}" ë‹¤ìš´ë¡œë“œ ì™„ë£Œ.`;
            } catch (e) { 
                this.term.writeln(`\x1b[31m[ERROR] íŒŒì¼ ë””ì½”ë”© ë˜ëŠ” ì €ì¥ ì‹¤íŒ¨: ${e.message}\x1b[0m`);
                this.ui.transferStatus.textContent = 'ì˜¤ë¥˜: íŒŒì¼ ë””ì½”ë”© ì‹¤íŒ¨.';
                this.state.fileDownloadInProgress = false;
            }
        },

        // --- ì´ë²¤íŠ¸ ë°”ì¸ë”© ---
        bindEvents() {
            // ë©”ì¸ ì»¨íŠ¸ë¡¤
            this.ui.connectBtn.addEventListener('click', () => this.connect());
            this.ui.disconnectBtn.addEventListener('click', () => this.disconnect());
            navigator.serial?.addEventListener('disconnect', (e) => { if (e.target === this.state.port) this.disconnect(); });
            this.ui.clearTermBtn.addEventListener('click', () => { this.term.clear(); this.term.write('\x1b[H\x1b[2J'); });
            this.ui.toggleAllSectionsBtn.addEventListener('click', () => this.toggleAllSections());

            // ê°„ë‹¨í•œ ëª…ë ¹ì–´ ë²„íŠ¼
            this.ui.cmdBtns.forEach(b => b.addEventListener('click', () => this.sendCommand(b.dataset.cmd)));
            
            // íŒŒì¼ & ê²½ë¡œ
            this.ui.cdAndLsBtn.addEventListener('click', () => { const p = this.ui.cdPathInput.value.trim(); if(p) this.sendCommand(`cd ${p} && ls -lha`); });
            this.ui.uploadFileBtn.addEventListener('click', () => this.handleFileUpload());
            this.ui.downloadFileBtn.addEventListener('click', () => this.handleFileDownload());

            // ê³ ê¸‰ ë„¤íŠ¸ì›Œí‚¹ & TSN
            this.ui.runEthtoolBtn.addEventListener('click', () => { const p = this.ui.ethtoolParamSelect.value; const i = this.ui.ethtoolIfaceInput.value.trim(); if(i) this.sendCommand(`ethtool ${p} ${i}`); });
            this.ui.runPtp4lBtn.addEventListener('click', () => { const i = this.ui.ptp4lIfaceInput.value.trim(); if(i) this.sendCommand(`ptp4l -2 -H -m -s -i ${i}`); });
            this.ui.runTcBtn.addEventListener('click', () => {
                const iface = this.ui.tcIfaceInput.value.trim(); const action = this.ui.tcActionSelect.value; const qdisc = this.ui.tcQdiscSelect.value;
                let cmd = '';
                if (qdisc === 'mqprio') cmd = `tc qdisc ${action} dev ${iface} root handle 1: mqprio hw 0 num_tc 5 map 1 1 2 3 4 queues 1@0 1@1 1@2 1@3 1@4`;
                else if (qdisc === 'cbs') cmd = `tc qdisc ${action} dev ${iface} parent 1:2 cbs idleslope 67000 sendslope -933000 hicredit 2147483647 locredit -2147483648 offload 1`;
                else if (qdisc === 'taprio') cmd = `tc qdisc ${action} dev ${iface} root taprio num_tc 5 map 0 1 2 3 4 queues 1@0 1@1 1@2 1@3 1@4 base-time 0 sched-entry S 10 50000 sched-entry S 0f 450000 sched-entry S 1f 96 flags 0x2`;
                if(cmd) this.sendCommand(cmd);
            });

            // ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ & ìº¡ì³
            this.ui.runTcpdumpBtn.addEventListener('click', () => { const o = this.ui.tcpdumpInput.value.trim(); if(o) { this.sendCommand(`tcpdump ${o}`); this.term.writeln(`\x1b[33m[SYSTEM] tcpdump ì‹œì‘ë¨. ì¤‘ì§€í•˜ë ¤ë©´ í„°ë¯¸ë„ì—ì„œ Ctrl+Cë¥¼ ì…ë ¥í•˜ì„¸ìš”.\x1b[0m`); } });
            this.ui.runIperfClientBtn.addEventListener('click', () => { const o = this.ui.iperfClientInput.value.trim(); if(o) this.sendCommand(`iperf3 -c ${o}`); });
            this.ui.pingBtn.addEventListener('click', () => { const h = this.ui.pingInput.value.trim(); if(h) this.sendCommand(`ping -c 4 ${h}`); });
            
            // CAN ë²„ìŠ¤
            this.ui.runCandumpBtn.addEventListener('click', () => { const i = this.ui.candumpInput.value.trim(); if(i) this.sendCommand(`candump ${i}`); });
            this.ui.sendCanBtn.addEventListener('click', () => { const c = this.ui.cansendInput.value.trim(); if(c) this.sendCommand(`cansend ${c}`); });

            // ì‹œìŠ¤í…œ & í”„ë¡œì„¸ìŠ¤
            this.ui.killBtn.addEventListener('click', () => { const p = this.ui.pidInput.value.trim(); if (p && confirm(`ì •ë§ë¡œ PID ${p} í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) this.sendCommand(`kill -9 ${p}`); });
            this.ui.rebootBtn.addEventListener('click', () => { if (confirm('ê²½ê³ : ì¥ì¹˜ë¥¼ ì¬ë¶€íŒ…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) this.sendCommand('reboot'); });
            this.ui.poweroffBtn.addEventListener('click', () => { if (confirm('ê²½ê³ : ì¥ì¹˜ì˜ ì „ì›ì„ ë„ì‹œê² ìŠµë‹ˆê¹Œ?')) this.sendCommand('poweroff'); });
        }
    };

    App.init();
});
</script>
</body>
</html>
